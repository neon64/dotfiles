#!/bin/sh

current_wallpaper=$(cat ~/.azotebg | grep "swaybg -o" | awk '{ print $4}' | tr -d \' )

# note, this only supports a single output
generate_lockscreen() {
    echo "Generating lockscreen background..."
    text="Type password to unlock..."
    dest=~/.local/share/swaylock_bg.jpg
    width=$(swaymsg -t get_outputs --raw | jq -r ".[0].current_mode.width | tostring")
    height=$(swaymsg -t get_outputs --raw | jq -r ".[0].current_mode.height | tostring")
    textheight=`expr $height / 3`
    dimensions="${width}x${height}^"
    echo "Using dimensions $dimensions, placing text at y=$textheight"
    convert "$current_wallpaper" -resize "$dimensions" -quality 95 -blur 40x20 -font /usr/share/fonts/cantarell/Cantarell-Light.otf -pointsize 36 -fill white -gravity Center -draw "text 0,${textheight} '$text'" $dest
    echo "Done"
}

generate_lockscreen
