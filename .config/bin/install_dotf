#!/bin/bash

dir="$(dirname $0)"
# load the platform-independent definitions & functions
. "$dir/install_dotfiles/definitions"
# load the platform-independent installation steps
. "$dir/install_dotfiles/user"

case $OS in
        'Linux')
            distro=$(uname -r)
            case "$distro" in
                *ARCH* | *arch* | '4.4.0-18362-Microsoft')
                    source "$dir/install_dotfiles/arch"
                    ;;
                *)
                    warn "Unsupported linux distro: $distro. Not installing any packages"
            esac
            ;;
        'Darwin')
            source "$dir/install_dotfiles/macos"
            ;;
        *)
            warn "Unsupported OS Kernel: $OS"
            exit 1
esac

section "1" "2" "system-level configuration"

install_system

section "2" "2" "user-level configuration:"

install_user

echo ""

if $FRESH_INSTALL; then
    header "Congratulations, installation completed!"
else
    header "System updated successfully"
fi

exit 0
