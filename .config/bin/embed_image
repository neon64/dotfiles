#!/bin/bash

GREEN="\033[32m"
BLUE="\033[34m"
RESET_FMT="\033[0m"
LINE_UP="\033[1A"

make_text() {
    for i in $1
    do
        b=$(basename $i)
        echo -e "![$b]($i)" 
        echo -e "\n - .\n\n"
    done
}

embed() {
	echo -e "${BLUE}Select Markdown document:${RESET_FMT}"
    file=$(env FZF_DEFAULT_COMMAND="fd -e md -t file" fzf --reverse --height=50%)
    if [ -z "$file" ]; then
        echo "No file selected... aborting"
        exit 1
    fi
    echo "Appending slides to '$file'"
    echo "" >> "$file"
    echo -e "$1" >> "$file"
}

echo -e "${BLUE}Select images to embed:${RESET_FMT}"
selected_files=$(env FZF_DEFAULT_COMMAND="fd -t file -e png -e jpg -e gif" fzf --multi --reverse --height=50%)
if [ -z "$selected_files" ]; then
    echo "No images selected... aborting"
    exit 1
fi

text=$(make_text "$selected_files")
echo -e "${LINE_UP}${BLUE}Markdown code to embed:${RESET_FMT}"
echo ""
echo "$text" | sed 's/^/  /'
echo ""
embed "$text"
